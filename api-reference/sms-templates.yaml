openapi: 3.0.3
info:
  title: MoEngage SMS Template API
  version: '1.0'
  description: API for creating, updating, and searching SMS templates within the MoEngage platform.
tags:
  - name: SMS Templates
    description: Operations to manage SMS templates.
servers:
  - url: 'https://api-0{dc}.moengage.com/v1.0'
    description: MoEngage Custom Templates API Server
    variables:
      dc:
        default: '1'
        description: 'Your MoEngage Data Center (DC). Can be 1, 2, 3, etc.'
        enum:
          - '1'
          - '2'
          - '3'
          - '4'
security:
  - basicAuth: []

paths:
  /custom-templates/sms:
    post:
      tags:
        - SMS Templates
      summary: Create SMS Template
      description: Creates a new SMS template in MoEngage. This allows you to upload templates created outside the MoEngage ecosystem and use them for campaign creation.
      requestBody:
        required: true
        description: The details of the SMS template to be created.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSmsTemplateRequest'
            example:
              basic_details:
                message: "Hello {{UserAttribute['first_name']}}, your order is on its way!"
              meta_info:
                created_by: "john.doe@example.com"
                template_id: "shipping_update_v1"
                template_name: "Shipping Update Template"
                template_version: "1"
      responses:
        '200':
          description: Template created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  external_template_id:
                    type: string
                    format: uuid
                    description: The unique ID assigned to the newly created template by MoEngage.
                    example: "d05a44f0-a7cf-471a-bcb6-63054800a367"
        '400':
          description: Bad Request. The request is invalid due to missing fields, duplicate `template_id` and `template_version`, or exceeding template limits.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication Failure.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden. Invalid App ID or Secret Key.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit breached (100 RPM) or template quota exceeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags:
        - SMS Templates
      summary: Update SMS Template
      description: Updates an existing SMS template by specifying its `external_template_id`.
      requestBody:
        required: true
        description: The updated details for the SMS template.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSmsTemplateRequest'
            example:
              external_template_id: "d05a44f0-a7cf-471a-bcb6-63054800a367"
              update_campaigns": false
              basic_details:
                message: "Hi {{UserAttribute['first_name']}}, your order has been delivered!"
              meta_info:
                template_name: "Shipping Update Template V2"
                updated_by": "jane.doe@example.com"
                template_version: "2"
      responses:
        '200':
          description: Template updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  external_template_id:
                    type: string
                    format: uuid
                    description: The unique ID of the updated template.
                    example: "eca024b7-a8ea-4f31-9154-5b80c85d18a9"
        '400':
          description: Bad Request. Invalid `external_template_id` or other request data validation errors.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '5XX':
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /custom-templates/sms/search:
    post:
      tags:
        - SMS Templates
      summary: Search SMS Templates
      description: Searches and retrieves a list of SMS templates based on specified filter criteria.
      requestBody:
        required: true
        description: Search filters for finding SMS templates. An empty body will fetch all templates.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchSmsTemplateRequest'
            example:
              page: 1
              entries: 10
              template_source: ["API"]
              sort_params:
                - last_modified_date: "DESCENDING"
      responses:
        '200':
          description: Search successful. Returns a list of templates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchSmsTemplateResponse'
        '400':
          description: Bad Request. Invalid field values in the search criteria.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit breached (100 RPM).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '5XX':
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
      description: Basic Authentication using Workspace ID as username and the 'Campaign report/Business events/Custom templates' API key as the password.

  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              example: "400 Bad Request"
            message:
              type: string
              example: "Duplicate - template_id and template_version"
            details:
              type: array
              items:
                type: object
                properties:
                  code: { type: string, example: "InvalidValue" }
                  target: { type: string, example: "Duplicate - template_id and template_version" }
                  message: { type: string, example: "template_id:BasicTemplate1 template_version:1 is already present." }
            request_id:
              type: string
              example: "cLCcgLQj"
        title:
          type: string
          description: An alternative error title format.
          example: "Authentication required"
        description:
          type: string
          description: An alternative error description format.
          example: "MOE-APPKEY missing in Authentication Header"

    CreateSmsTemplateRequest:
      type: object
      required:
        - basic_details
        - meta_info
      properties:
        basic_details:
          type: object
          required:
            - message
          properties:
            message:
              type: string
              description: The content of the SMS message.
        meta_info:
          type: object
          required:
            - created_by
            - template_id
            - template_name
            - template_version
          properties:
            created_by:
              type: string
              description: Identifier for the creator of the template.
            template_id:
              type: string
              description: A unique ID for the template provided by you.
            template_name:
              type: string
              description: The name of the template.
            template_version:
              type: string
              description: The version of the template.

    UpdateSmsTemplateRequest:
      type: object
      required:
        - external_template_id
        - basic_details
        - meta_info
      properties:
        external_template_id:
          type: string
          format: uuid
          description: The unique ID generated by MoEngage during template creation.
        update_campaigns:
          type: boolean
          default: false
          description: If true, updates all active campaigns using this template to the new version.
        basic_details:
          type: object
          required:
            - message
          properties:
            message:
              type: string
              description: The updated content of the SMS message.
        meta_info:
          type: object
          required:
            - template_name
            - updated_by
          properties:
            template_name:
              type: string
              description: The name of the template being updated.
            updated_by:
              type: string
              format: email
              description: The email ID of the person updating the template.
            template_version:
              type: string
              description: Optional new version for the template.

    SearchSmsTemplateRequest:
      type: object
      description: All fields are optional. An empty request body will fetch all templates.
      properties:
        page:
          type: integer
          description: The page number of the results to fetch.
          default: 1
        entries:
          type: integer
          description: The number of templates to return per page.
          maximum: 15
          default: 15
        template_name:
          type: string
          description: The name of the template to search for (partial search supported).
        template_source:
          type: array
          items:
            type: string
            enum: [API, MOENGAGE]
        template_type:
          type: array
          items:
            type: string
            enum: [CUSTOM, PRE_BUILT]
        created_by:
          type: array
          items:
            type: string
            format: email
        updated_by:
          type: array
          items:
            type: string
            format: email
        sort_params:
          type: array
          items:
            type: object
            properties:
              template_name:
                type: string
                enum: [ASCENDING, DESCENDING]
              last_modified_date:
                type: string
                enum: [ASCENDING, DESCENDING]
              last_modified_by:
                type: string
                enum: [ASCENDING, DESCENDING]
        template_ids:
          type: array
          items:
            type: object
            properties:
              external_template_id:
                type: string
                format: uuid
              version:
                type: integer

    SmsTemplate:
      type: object
      properties:
        external_template_id:
          type: string
          format: uuid
        version:
          type: integer
        basic_details:
          type: object
          properties:
            message:
              type: string
        meta_info:
          type: object
          properties:
            template_id: { type: string }
            template_name: { type: string }
            template_version: { type: string }
            created_by: { type: string }
            channel: { type: string, example: "SMS" }
            template_type: { type: string, enum: [CUSTOM, PRE_BUILT] }
        created_by:
          type: string
        created_at:
          type: string
          format: date-time
        updated_by:
          type: string
        updated_at:
          type: string
          format: date-time

    SearchSmsTemplateResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/SmsTemplate'